<script src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.11.0/es6-shim.js"></script>

R
<input id="r" type="range" min="0" max="255" step="1" value="0">
<output></output><br>
G
<input id="g" type="range" min="0" max="255" step="1" value="0">
<output></output><br>
B
<input id="b" type="range" min="0" max="255" step="1" value="0">
<output></output><br>

<!-- Luminence
<input id="b" type="range" min="0" max="255" step="1" value="0">
<output></output><br>

 -->
Sync?
<input id="sync" type="checkbox"><br>

<div id="color" style="width:200px;height:200px;border:1px solid"></div>

<hr>
<button id="pulse">Pulse</button>
<button id="crossfade">Crossfade</button>
<button id="luminanceBlack">Luminance - to black</button>
<button id="luminanceWhite">Luminance - to white</button>
<button id="stop">Stop</button>

<script>

function isSynced() {
  return checkbox.checked;
}

function syncTo(value) {
  ranges.forEach(function(range) {
    range.value = value;
  });
}

function hex(dec) {
  var hex = dec.toString(16);

  if (hex.length === 1) {
    hex = "0" + hex;
  }

  return hex;
}

function rgb() {
  return ranges.map(function(range) {
    return hex(range.valueAsNumber);
  });
}

function update() {
  var hexValues = rgb();

  ranges.forEach(function(range, i) {
    range.nextElementSibling.textContent = hexValues[i];
  });

  color.style.backgroundColor = "#" + hexValues.join("");
}

var ranges = Array.from(document.querySelectorAll("input[type='range']"));
var buttons = Array.from(document.querySelectorAll("button"));
var checkbox = document.querySelector("input[type='checkbox']");
var color = document.getElementById("color");
var last = null;
var interval = null;
var frame = null;
var actions = {
  pulse: function() {
    actions.stop();

    var value = 0;
    var direction = 1;

    checkbox.checked = true;

    interval = setInterval(function() {
      syncTo(value += direction);
      update();

      if (value === 255 || value === 0) {
        direction *= -1;
        console.log( "?" );
      }
    }, 1);
  },
  crossfade: function() {
    actions.stop();

    var colors = [
      [0xff, 0x00, 0x00], // red hex code:   ff0000
      [0x00, 0xff, 0x00], // green hex code: 00ff00
      [0x00, 0x00, 0xff], // blue hex code:  0000ff
    ];

    var indices = [
      [1, 0],
      [2, 1],
      [0, 2]
    ];

    var color = 0;
    var index = 0;
    var current = 0;
    var start = Date.now();
    var wait = 10;
    var values = [0, 0, 0];

    function loop() {
      frame = requestAnimationFrame(loop);

      var hexValues = colors[color];
      var rangeIndices = indices[index];

      if (Date.now() >= start + wait) {
        if (current === 0) {
          values = hexValues.slice();
        }

        rangeIndices.forEach(function(index, i) {
          if (!i) {
            values[index] += 1;
          } else {
            values[index] -= 1;
          }

          ranges[index].value = 255 - values[index];
        });

        update();
        current++;

        if (current === 256) {
          current = 0;
          color++;
          index++;

          if (color === 3) {
            color = 0;
            index = 0;
          }
        }
      }
    }

    frame = requestAnimationFrame(loop);
  },
  luminanceBlack: function() {
    var cValues = ranges.map(function(range) {
      return range.valueAsNumber;
    });
    var nValues = null;
    var current = 0;
    var step = 1;
    var start = Date.now();
    var wait = 50;

    // Reset the ranges after we've captured the
    // the currently set slider values.
    actions.stop();

    function loop() {
      frame = requestAnimationFrame(loop);

      if (Date.now() >= start + wait) {
        nValues = luminance(cValues, (current / 100) * -1);

        ranges.forEach(function(range, i) {
          range.value = parseInt("0x" + nValues[i], 16);
        });

        update();

        current += step;

        if (current === 100) {
          actions.stop();
        }
      }
    }

    frame = requestAnimationFrame(loop);
  },
  luminanceWhite: function() {
    var cValues = ranges.map(function(range) {
      return range.valueAsNumber;
    });
    var nValues = null;
    var current = 0;
    var step = 1;
    var start = Date.now();
    var wait = 50;

    // Reset the ranges after we've captured the
    // the currently set slider values.
    actions.stop();

    function loop() {
      frame = requestAnimationFrame(loop);

      if (Date.now() >= start + wait) {
        nValues = luminance(cValues, (current / 100) * -1);

        ranges.forEach(function(range, i) {
          var val = parseInt("0x" + nValues[i], 16);

          val ^= 255;

          range.value = val;
        });

        update();

        current += step;

        if (current === 100) {
          actions.stop();
        }
      }
    }

    frame = requestAnimationFrame(loop);
  },
  stop: function() {
    clearInterval(interval);
    cancelAnimationFrame(frame);
    syncTo(0);
  }
}


ranges.forEach(function(range) {
  range.oninput = function() {
    var value = this.valueAsNumber;

    last = this;

    if (isSynced()) {
      syncTo(value);
    }

    update();
  };
});

buttons.forEach(function(button) {
  button.onclick = actions[button.id];
});

checkbox.onclick = function() {
  var index;

  if (last !== null) {
    syncTo(last.valueAsNumber);
  } else {
    index = ranges.findIndex(function(range) {
      return range.valueAsNumber > 0;
    });
  }

  console.log( this.checked );
};


function luminance(hexValues, lum) {
  var rgb = [];
  var hex;

  for (var i = 0; i < 3; i++) {
    hex = hexValues[i];
    hex = Math.round(Math.min(Math.max(0, hex + (hex * lum)), 255)).toString(16);
    rgb.push(("00" + hex).substr(hex.length));
  }

  return rgb;
}
</script>




